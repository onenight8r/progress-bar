<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <meta charset="UTF-8">
  <title>Rating Circles</title>
  <style>
   body {
  margin: 0;
  padding: 0;
  background: transparent; /* transparent so only the box shows */
  display: flex;
  justify-content: center;
  align-items: center;
}

.dashboard {
  border: none;
  border-radius: 20px;
  padding: 20px;
  background: #2d0b63; /* deep purple card */
  box-shadow: 0 8px 20px rgba(0,0,0,0.3);
  width: 100%;              /* 80% of screen */
  margin: 0 auto;          /* center horizontally */
  position: relative;
}
.date {
  position: absolute;
  top: 10px;
  right: 20px;
  font-size: 0.9rem;
  color: #cfc2ff;
  font-weight: 500;
}

.container {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  gap: 40px;               /* spacing between items */
  justify-items: center;   /* center each card in its column */
  margin-top: 60px;
  width: 100%;
}
.circle-content {
  position: absolute;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

.circle-content .material-icons {
  font-size: 32px;
  color: #ffe066;  /* neon yellow */
  margin-bottom: 5px;
}

.circle-content {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}


.circle-card {
  perspective: 1000px;
  width: 140px;   /* fixed smaller width */
  height: 180px;  /* shorter height */
  display: flex;
  flex-direction: column;
  align-items: center;
}

.circle-inner {
  position: relative;
  width: 150px;
  height: 150px;
  transform-style: preserve-3d;
  transition: transform 0.6s;
  border-radius: 50%;
}

.circle-front, .circle-back {
  position: absolute;
  width: 100%;
  height: 100%;
  backface-visibility: hidden;
  border-radius: 50%;
  display: flex;
  justify-content: center;
  align-items: center;
  background: #4b0a91; /* neon purple */
  box-shadow: 
    0 8px 16px rgba(0,0,0,0.3),
    0 0 20px rgba(255,255,255,0.1),
    inset 0 0 10px rgba(255,255,255,0.2);
}

.circle-back {
  transform: rotateY(180deg);
  background: #37006d; 
  border-radius: 20px;
  border: 2px solid #7a3fff;
}

.circle-front span {
  font-size: 3rem;
  font-weight: bold;
  color: #fff;
  z-index: 2;
}

.circle-title {
  margin-top: 12px;
  font-size: 1rem;
  font-weight: 600;
  text-align: center;
  letter-spacing: 1px;
  text-transform: uppercase;
  color: #ffe066; /* neon yellow */
}

.circle-back form {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 10px;
  color: #fff;
}

.circle-back input {
  margin: 5px 0;
  padding: 5px;
  width: 70px;
  text-align: center;
  border-radius: 8px;
  border: none;
  font-size: 1rem;
  background: #ffe066;
  color: #2d0b63;
  font-weight: bold;
}

.circle-back button {
  padding: 6px 14px;
  background: #ff2d96; /* neon pink */
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  margin-top: 10px;
  font-weight: 600;
}

svg {
  position: absolute;
  top: 0;
  left: 0;
  transform: rotate(-90deg);
}

circle {
  fill: none;
  stroke-width: 12;
  stroke-linecap: round;
}

.bg {
  stroke: rgba(255,255,255,0.1);
}

/* --- Keep progress color in sync after reload (no default green) --- */
.progress {
  stroke: #999;
  transition: stroke 0.3s ease, stroke-dashoffset 0.6s ease;
}

/* 1–4 = red */
.circle-card:has(.circle-back input[value="1"]) .progress,
.circle-card:has(.circle-back input[value="2"]) .progress,
.circle-card:has(.circle-back input[value="3"]) .progress,
.circle-card:has(.circle-back input[value="4"]) .progress {
  stroke: #F44336;
}
.circle-card:has(.circle-back input[value="1"]) .circle-front .rating,
.circle-card:has(.circle-back input[value="2"]) .circle-front .rating,
.circle-card:has(.circle-back input[value="3"]) .circle-front .rating,
.circle-card:has(.circle-back input[value="4"]) .circle-front .rating {
  color: #F44336;
}

/* 5–7 = yellow */
.circle-card:has(.circle-back input[value="5"]) .progress,
.circle-card:has(.circle-back input[value="6"]) .progress,
.circle-card:has(.circle-back input[value="7"]) .progress {
  stroke: #FFC107;
}
.circle-card:has(.circle-back input[value="5"]) .circle-front .rating,
.circle-card:has(.circle-back input[value="6"]) .circle-front .rating,
.circle-card:has(.circle-back input[value="7"]) .circle-front .rating {
  color: #FFC107;
}

/* 8–10 = green */
.circle-card:has(.circle-back input[value="8"]) .progress,
.circle-card:has(.circle-back input[value="9"]) .progress,
.circle-card:has(.circle-back input[value="10"]) .progress {
  stroke: #4CAF50;
}
.circle-card:has(.circle-back input[value="8"]) .circle-front .rating,
.circle-card:has(.circle-back input[value="9"]) .circle-front .rating,
.circle-card:has(.circle-back input[value="10"]) .circle-front .rating {
  color: #4CAF50;
}

    .circle-card.flipped .circle-inner {
  transform: rotateY(180deg);
}



  </style>
</head>
<body>
  <div class="dashboard">
    <div class="date" id="today-date"></div>
    <div class="container" id="rating-container"></div>
    <div class="average" id="average-rating"></div>
  </div>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyAU8fNHMvaySDjL4BUV1vrfRM6hZ81tJQQ",
      authDomain: "build-your-life-b88e5.firebaseapp.com",
      projectId: "build-your-life-b88e5",
      storageBucket: "build-your-life-b88e5.firebasestorage.app",
      messagingSenderId: "1014133716094",
      appId: "1:1014133716094:web:5507147a7c4fc73711d42f",
      measurementId: "G-RGVT8T96GH"
    };

    // Init Firebase + Firestore
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // categories
    const categories = ["Mind", "Health", "Money", "Sleep", "Career", "Discipline"];

    // local defaults
    let ratings = {Mind: 7, Health: 7, Money: 7, Sleep: 7, Career: 7, Discipline: 7};

    const container = document.getElementById("rating-container");

    // ✅ Load ratings from Firestore (or fallback to defaults)
    async function loadRatings() {
      try {
        const ref = doc(db, "users", "defaultUser"); // adjust "users/defaultUser" if you want per-user storage
        const snap = await getDoc(ref);
        if (snap.exists()) {
          ratings = snap.data();
        } else {
          // store defaults if no data exists
          await setDoc(ref, ratings);
        }
      } catch (err) {
        console.error("⚠️ Firebase fetch failed, using local defaults", err);
      }
      renderCircles();
      updateAverage();
    }

    // ✅ Save single rating to Firestore
    async function saveRating() {
      try {
        const ref = doc(db, "users", "defaultUser");
        await setDoc(ref, ratings);
      } catch (err) {
        console.error("⚠️ Failed to save rating to Firebase", err);
      }
    }

    function renderCircles() {
      container.innerHTML = "";
      categories.forEach(cat => {
        const card = document.createElement("div");
        card.className = "circle-card";

        const radius = 60;
        const circumference = 2 * Math.PI * radius;

        card.innerHTML = `
          <div class="circle-inner">
            <div class="circle-front">
              <svg width="150" height="150">
                <circle class="bg" cx="75" cy="75" r="${radius}"></circle>
                <circle class="progress" cx="75" cy="75" r="${radius}" 
                  stroke-dasharray="${circumference}" 
                  stroke-dashoffset="${circumference - (ratings[cat] / 10) * circumference}">
                </circle>
              </svg>
              <div class="">
                <span class="material-icons">${getIcon(cat)}</span>
                <span class="rating">${ratings[cat]}</span>
              </div>
            </div>
            <div class="circle-back">
              <form>
                <label>${cat} Rating</label>
                <input type="number" min="1" max="10" value="${ratings[cat]}">
                <button type="submit">Save</button>
              </form>
            </div>
          </div>
          <div class="circle-title">${cat}</div>
        `;

        // Flip
        card.querySelector(".circle-inner").addEventListener("click", function(e) {
          if (!e.target.closest("form")) {
            card.classList.toggle("flipped");
          }
        });

        // Save form
        card.querySelector("form").addEventListener("submit", function(e) {
          e.preventDefault();
          const newVal = parseInt(this.querySelector("input").value);
          if (newVal < 1 || newVal > 10) return;
          ratings[cat] = newVal;

          const progress = card.querySelector(".progress");
          const span = card.querySelector(".rating");

          progress.setAttribute("stroke-dashoffset", circumference - (newVal / 10) * circumference);
          progress.style.stroke = getColor(newVal);
          span.innerText = newVal;

          card.classList.remove("flipped");

          updateAverage();
          saveRating(); // ✅ push change to Firebase
        });

        container.appendChild(card);
      });
    }

    function getIcon(category) {
      switch(category) {
        case "Mind": return "psychology";
        case "Health": return "fitness_center";
        case "Money": return "account_balance_wallet";
        case "Sleep": return "bedtime";
        case "Career": return "work";
        case "Discipline": return "self_improvement";
        default: return "star";
      }
    }

    function getColor(value) {
      if (value >= 8) return "#4CAF50";
      if (value >= 5) return "#FFC107";
      return "#F44336";
    }

    function updateAverage() {
      const avg = Object.values(ratings).reduce((a,b)=>a+b,0) / categories.length;
      document.getElementById("average-rating").innerText = `Average: ${avg.toFixed(1)}`;
    }

    // today's date
    document.getElementById("today-date").innerText = "TODAY'S DATE - 24 AUG' 25";

    // load everything
    loadRatings();
  </script>
 
</body>
</html>
